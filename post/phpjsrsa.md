---
title: "使用php,js来对内容做rsa加密"
date: 2009-12-27T18:12:00+08:00
showDate: true
draft: false
tags: ["blog","tech","crypto","programming"]
---

http://code.google.com/p/phpjsrsa/

这是一个用于文本加密的库，主要用于http协议下的防窃听。一般来说，如果应用https协议可以有效的避免窃听。但有几种情况必须考虑。

(1) 主机同时有https和http协议，部分用户通过https协议访问，获得了保护。但也有用户通过http访问，这部分用户会遭到窃听。除非关闭http请求，全面转向https。
(2) 主机并没有https支持。

很多情况下，我们需要保证主机安全，最好的办法是将其混入数字森林中。即：这台主机输出的内容没有人能看得懂的，只由无意义的代码和数字组成。用户浏览这台主机，不会触发任何关键词扫描。甚至该主机连https协议都不使用，更凸显其低调本色。

换言之，一个网站如果把自己的内容都变成字母和数字的组合，且不使用https协议，那么他就是数字森林中的一片树叶，丝毫不引人注意。

我们的目标应该是传输过程中不引人注意，并非绝对的不可破解的安全。

因此这个库的工作流程是： 

1. php对"内容"做rsa加密->将加密结果输出到页面上。
2. 用户浏览页面，html代码中的"内容"被加密成数字形态。私钥可以直接输出在页面代码中，也可由用户输入一次，保存在cookie中。使用cookie会降低密钥泄露的危险，更加有效。
3. 通过javascript在用户浏览器上将这些数字解密为内容。
4. 通过javascript dom来把内容写回到页面上。用户即可浏览。

利用javascript解密，可以把运算负担分散到客户端上。窃听者如要窃听每一个页面的内容，则必须要 1 获得密钥 2 用密钥解密内容

在已知密钥情况下，如客户端的每个页面运算负担为 1 ，页面数量n ，那么窃听者获得密钥之后的运算负担为 1*n。

为了运算效率，使用小质数作为rsa的p,q，理论上窃听者可以通过因数分解算出密钥，其运算负载为k，注意k 远远大于1。

如果每个站点使用不同的密钥，共计m个站点，窃听者的运算负担为 m*k+1*n，且负载集中。

而，如果采用双向可逆加密方法，在得知算法的情况下，窃听者运算负载极小。如果在通过变换算法来增加难度，又无法做到通用，给用户正常浏览造成困难。使用rsa方法，算法是标准的，用户使用成本很低，窃听成本很高。

在项目代码中，我已经实现了这一目标。但仍然有效率问题。

目前问题：

1 在没有bcmath和gnumath函数的php主机上，php加密内容的运算效率很低。和bcmath差距几十倍。好在大部分情况下，主机都是有bcmath函数的。这个问题不严重。
2 JS的bigint运算效率很低，主要是powmod的效率低，而这是rsa解密最频繁的操作。

希望有兴趣的朋友加入这个项目。效率问题解决后，还需要port在一系列常用软件上。比如dabr或twitese等。

另外，需要的质数可以在 http://www.prime-numbers.org 找。

update: 使用了 http://www-cs-students.stanford.edu/~tjw/jsbn/ 的大数运算库，效率提高很多。

2010/01/01 Ariagle has released a http://blog.lolily.com/wordpress-plugin-wp-no-keyword.html'>wordpress plugin , It encodes keyword into digitals by phpjsrsa :)
